import{S as e,i as t,s,l as a,f as n,d as l,e as r,t as o,c,a as i,g as d,b as f,E as h,h as u,H as m,I as p,k as v,n as g,v as b,r as x,u as y,J as E,z as S,y as N,K as w,B as P,L as O,M as T,N as I,O as k,P as q,Q as U,R as _,T as B}from"../chunks/vendor-0d7a9b8a.js";function M(e,t,s){const a=e.slice();return a[13]=t[s],a}function L(e,t,s){const a=e.slice();return a[16]=t[s].from,a[17]=t[s].text,a[18]=t[s].to,a}function R(e){let t,s,a,m,p,b,x,y,E,S,N=e[16]+"",w=e[18]+"",P=e[17]+"";return{c(){t=r("p"),s=o(N),a=o(" → "),m=o(w),b=v(),x=r("p"),y=o(P),E=v(),this.h()},l(e){t=c(e,"P",{class:!0,m:!0});var n=i(t);s=d(n,N),a=d(n," → "),m=d(n,w),n.forEach(l),b=g(e),x=c(e,"P",{class:!0,bg:!0,text:!0,p:!0,border:!0});var r=i(x);y=d(r,P),E=g(r),r.forEach(l),this.h()},h(){f(t,"class",p=e[16]===e[1].name?"self-end":"self-start"),f(t,"m","t-2"),f(x,"class",S=e[16]===e[1].name?"self-end":"self-start"),f(x,"bg","blue-600"),f(x,"text","light-300"),f(x,"p","2"),f(x,"border","rounded")},m(e,l){n(e,t,l),h(t,s),h(t,a),h(t,m),n(e,b,l),n(e,x,l),h(x,y),h(x,E)},p(e,a){1&a&&N!==(N=e[16]+"")&&u(s,N),1&a&&w!==(w=e[18]+"")&&u(m,w),3&a&&p!==(p=e[16]===e[1].name?"self-end":"self-start")&&f(t,"class",p),1&a&&P!==(P=e[17]+"")&&u(y,P),3&a&&S!==(S=e[16]===e[1].name?"self-end":"self-start")&&f(x,"class",S)},d(e){e&&l(t),e&&l(b),e&&l(x)}}}function W(e){let t,s,a=e[17]+"";return{c(){t=r("p"),s=o(a),this.h()},l(e){t=c(e,"P",{bg:!0,m:!0,p:!0,border:!0});var n=i(t);s=d(n,a),n.forEach(l),this.h()},h(){f(t,"bg","orange-600"),f(t,"m","t-2"),f(t,"p","2"),f(t,"border","rounded")},m(e,a){n(e,t,a),h(t,s)},p(e,t){1&t&&a!==(a=e[17]+"")&&u(s,a)},d(e){e&&l(t)}}}function A(e){let t;function s(e,t){return"Server"===e[16]?W:R}let r=s(e),o=r(e);return{c(){o.c(),t=a()},l(e){o.l(e),t=a()},m(e,s){o.m(e,s),n(e,t,s)},p(e,a){r===(r=s(e))&&o?o.p(e,a):(o.d(1),o=r(e),o&&(o.c(),o.m(t.parentNode,t)))},d(e){o.d(e),e&&l(t)}}}function D(e){let t,s,a,v;return{c(){t=r("p"),s=o(e[4]),this.h()},l(a){t=c(a,"P",{p:!0,bg:!0,text:!0});var n=i(t);s=d(n,e[4]),n.forEach(l),this.h()},h(){f(t,"p","4"),f(t,"bg","red-600"),f(t,"text","light-300")},m(e,a){n(e,t,a),h(t,s),v=!0},p(e,t){(!v||16&t)&&u(s,e[4])},i(e){v||(m((()=>{a||(a=p(t,w,{},!0)),a.run(1)})),v=!0)},o(e){a||(a=p(t,w,{},!1)),a.run(0),v=!1},d(e){e&&l(t),e&&a&&a.end()}}}function V(e){let t,s,a,p,b,x,y,E,S,N,w,P,O,L,R,W,A,D,V=e[1].name+"",$=[],J=new Map,F=e[3];const H=e=>e[13].name;for(let n=0;n<F.length;n+=1){let t=M(e,F,n),s=H(t);J.set(s,$[n]=C(s,t))}return{c(){t=r("p"),s=o("Welcome, "),a=o(V),p=v(),b=r("label"),x=o("Send to"),y=v(),E=r("select");for(let e=0;e<$.length;e+=1)$[e].c();S=v(),N=r("form"),w=r("div"),P=r("input"),O=v(),L=r("button"),R=o("Send Message"),this.h()},l(e){t=c(e,"P",{});var n=i(t);s=d(n,"Welcome, "),a=d(n,V),n.forEach(l),p=g(e),b=c(e,"LABEL",{for:!0,m:!0});var r=i(b);x=d(r,"Send to"),r.forEach(l),y=g(e),E=c(e,"SELECT",{id:!0,w:!0,class:!0});var o=i(E);for(let t=0;t<$.length;t+=1)$[t].l(o);o.forEach(l),S=g(e),N=c(e,"FORM",{m:!0});var f=i(N);w=c(f,"DIV",{display:!0});var h=i(w);P=c(h,"INPUT",{flex:!0,id:!0,type:!0,class:!0}),O=g(h),L=c(h,"BUTTON",{type:!0,class:!0});var u=i(L);R=d(u,"Send Message"),u.forEach(l),h.forEach(l),f.forEach(l),this.h()},h(){f(b,"for","to"),f(b,"m","r-1"),f(E,"id","to"),f(E,"w","min-24"),f(E,"class","svelte-1lavqcd"),void 0===e[2].to&&m((()=>e[9].call(E))),f(P,"flex","1"),f(P,"id","message"),f(P,"type","text"),f(P,"class","svelte-1lavqcd"),L.disabled=W=e[2].text.length<1,f(L,"type","submit"),f(L,"class","svelte-1lavqcd"),f(w,"display","flex"),f(N,"m","t-4")},m(l,r){n(l,t,r),h(t,s),h(t,a),n(l,p,r),n(l,b,r),h(b,x),n(l,y,r),n(l,E,r);for(let e=0;e<$.length;e+=1)$[e].m(E,null);T(E,e[2].to),n(l,S,r),n(l,N,r),h(N,w),h(w,P),I(P,e[2].text),h(w,O),h(w,L),h(L,R),A||(D=[k(E,"change",e[9]),k(P,"input",e[10]),k(N,"submit",q(e[6]))],A=!0)},p(e,t){2&t&&V!==(V=e[1].name+"")&&u(a,V),10&t&&(F=e[3],$=U($,t,H,1,e,F,J,E,B,C,null,M)),12&t&&T(E,e[2].to),12&t&&P.value!==e[2].text&&I(P,e[2].text),12&t&&W!==(W=e[2].text.length<1)&&(L.disabled=W)},d(e){e&&l(t),e&&l(p),e&&l(b),e&&l(y),e&&l(E);for(let t=0;t<$.length;t+=1)$[t].d();e&&l(S),e&&l(N),A=!1,_(D)}}}function $(e){let t,s,a,u,m,p,b,x,y,E,S,N,w,P;return{c(){t=r("form"),s=r("label"),a=o("Username"),u=v(),m=r("div"),p=r("input"),b=v(),x=r("button"),y=o("Request Username"),S=v(),N=r("br"),this.h()},l(e){t=c(e,"FORM",{});var n=i(t);s=c(n,"LABEL",{for:!0});var r=i(s);a=d(r,"Username"),r.forEach(l),u=g(n),m=c(n,"DIV",{m:!0,display:!0});var o=i(m);p=c(o,"INPUT",{flex:!0,id:!0,type:!0,class:!0}),b=g(o),x=c(o,"BUTTON",{type:!0,class:!0});var f=i(x);y=d(f,"Request Username"),f.forEach(l),o.forEach(l),n.forEach(l),S=g(e),N=c(e,"BR",{}),this.h()},h(){var t;f(s,"for","username"),f(p,"flex","1"),f(p,"id","username"),f(p,"type","text"),f(p,"class","svelte-1lavqcd"),x.disabled=E=(null==(t=e[5])?void 0:t.length)<1,f(x,"type","submit"),f(x,"class","svelte-1lavqcd"),f(m,"m","t-2"),f(m,"display","flex")},m(l,r){n(l,t,r),h(t,s),h(s,a),h(t,u),h(t,m),h(m,p),I(p,e[5]),h(m,b),h(m,x),h(x,y),n(l,S,r),n(l,N,r),w||(P=[k(p,"input",e[8]),k(t,"submit",q(e[7]))],w=!0)},p(e,t){var s;32&t&&p.value!==e[5]&&I(p,e[5]),32&t&&E!==(E=(null==(s=e[5])?void 0:s.length)<1)&&(x.disabled=E)},d(e){e&&l(t),e&&l(S),e&&l(N),w=!1,_(P)}}}function J(e){let t,s,a,m=e[13].name+"";return{c(){t=r("option"),s=o(m),this.h()},l(e){t=c(e,"OPTION",{class:!0});var a=i(t);s=d(a,m),a.forEach(l),this.h()},h(){t.__value=a=e[13].name,t.value=t.__value,f(t,"class","svelte-1lavqcd")},m(e,a){n(e,t,a),h(t,s)},p(e,n){8&n&&m!==(m=e[13].name+"")&&u(s,m),8&n&&a!==(a=e[13].name)&&(t.__value=a,t.value=t.__value)},d(e){e&&l(t)}}}function C(e,t){let s,r,o="Server"!=t[13].name&&t[13].name!=t[1].name&&J(t);return{key:e,first:null,c(){s=a(),o&&o.c(),r=a(),this.h()},l(e){s=a(),o&&o.l(e),r=a(),this.h()},h(){this.first=s},m(e,t){n(e,s,t),o&&o.m(e,t),n(e,r,t)},p(e,s){"Server"!=(t=e)[13].name&&t[13].name!=t[1].name?o?o.p(t,s):(o=J(t),o.c(),o.m(r.parentNode,r)):o&&(o.d(1),o=null)},d(e){e&&l(s),o&&o.d(e),e&&l(r)}}}function F(e){let t,s,a,m,p,S,N,w,O,T,I,k,q,U=e[3].length-2+"",_=e[0],B=[];for(let n=0;n<_.length;n+=1)B[n]=A(L(e,_,n));let M=e[4]&&D(e);function R(e,t){return e[1].name?V:$}let W=R(e),J=W(e);return{c(){t=r("div"),s=r("p"),a=o("Number of users: "),m=o(U),p=v(),S=r("div"),N=r("p"),w=o("Start of conversation"),O=v();for(let e=0;e<B.length;e+=1)B[e].c();T=v(),M&&M.c(),I=v(),k=r("div"),J.c(),this.h()},l(e){t=c(e,"DIV",{bg:!0,p:!0});var n=i(t);s=c(n,"P",{text:!0});var r=i(s);a=d(r,"Number of users: "),m=d(r,U),r.forEach(l),n.forEach(l),p=g(e),S=c(e,"DIV",{id:!0,display:!0,flex:!0,p:!0,overflow:!0,class:!0});var o=i(S);N=c(o,"P",{font:!0});var f=i(N);w=d(f,"Start of conversation"),f.forEach(l),O=g(o);for(let t=0;t<B.length;t+=1)B[t].l(o);o.forEach(l),T=g(e),M&&M.l(e),I=g(e),k=c(e,"DIV",{bg:!0,p:!0});var h=i(k);J.l(h),h.forEach(l),this.h()},h(){f(s,"text","light-300"),f(t,"bg","dark-300"),f(t,"p","4"),f(N,"font","italic"),f(S,"id","messages"),f(S,"display","flex"),f(S,"flex","1 col"),f(S,"p","y-4 l-4"),f(S,"overflow","y-scroll"),f(S,"class","svelte-1lavqcd"),f(k,"bg","dark-300"),f(k,"p","4")},m(e,l){n(e,t,l),h(t,s),h(s,a),h(s,m),n(e,p,l),n(e,S,l),h(S,N),h(N,w),h(S,O);for(let t=0;t<B.length;t+=1)B[t].m(S,null);n(e,T,l),M&&M.m(e,l),n(e,I,l),n(e,k,l),J.m(k,null),q=!0},p(e,[t]){if((!q||8&t)&&U!==(U=e[3].length-2+"")&&u(m,U),3&t){let s;for(_=e[0],s=0;s<_.length;s+=1){const a=L(e,_,s);B[s]?B[s].p(a,t):(B[s]=A(a),B[s].c(),B[s].m(S,null))}for(;s<B.length;s+=1)B[s].d(1);B.length=_.length}e[4]?M?(M.p(e,t),16&t&&b(M,1)):(M=D(e),M.c(),b(M,1),M.m(I.parentNode,I)):M&&(P(),x(M,1,1,(()=>{M=null})),y()),W===(W=R(e))&&J?J.p(e,t):(J.d(1),J=W(e),J&&(J.c(),J.m(k,null)))},i(e){q||(b(M),q=!0)},o(e){x(M),q=!1},d(e){e&&l(t),e&&l(p),e&&l(S),E(B,e),e&&l(T),M&&M.d(e),e&&l(I),e&&l(k),J.d()}}}function H(e,t,s){const a={name:""},n={from:"",text:"Hello, World!",to:"All"};let l,r=[{name:"All"},{name:"Server"}],o="",c=[],i=`Guest #${(9999*Math.random()).toFixed(0)}`;function d(e){s(4,o=e),setTimeout((()=>s(4,o="")),2500)}return S((()=>{var e,t=window.location;e="https:"===t.protocol?"wss:":"ws:",e+="//"+t.host,e+=t.pathname+"/ws",l=new WebSocket(e),l.onclose=function(e){d("Connection to the server was lost.")},l.onerror=function(e){d("Connection to the server was lost.")},l.onmessage=function(e){const t=JSON.parse(e.data);if("message"===t.type){const e=t.data;s(0,c=[...c,e])}else if("update"===t.type){const e=t.data;t.success?(s(1,a.name=e.name,a),s(2,n.from=e.name,n)):d("That username is taken!")}else"list"===t.type&&(s(3,r=t.data),s(2,n.to=-1!=r.findIndex((e=>e.name===n.to))?n.to:"All",n))}})),e.$$.update=()=>{1&e.$$.dirty&&c&&N((()=>{const e=document.getElementById("messages");e.scrollTop=e.scrollHeight}))},[c,a,n,r,o,i,function(){const e={type:"message",data:n};l.readyState===WebSocket.OPEN?(l.send(JSON.stringify(e)),s(2,n.text="",n)):d("Server is unresponsive.")},function(){const e={type:"update",data:{name:i}};l.readyState===WebSocket.OPEN?l.send(JSON.stringify(e)):d("Server is unresponsive.")},function(){i=this.value,s(5,i)},function(){n.to=O(this),s(2,n),s(3,r)},function(){n.text=this.value,s(2,n),s(3,r)}]}export default class extends e{constructor(e){super(),t(this,e,H,F,s,{})}}
